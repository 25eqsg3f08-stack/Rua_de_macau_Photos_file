<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>澳门罕有街道影像集</title>
    <link rel="stylesheet" href="./css/style.css">
    <!-- 引入 Leaflet CSS -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""
    />
    <!-- 引入 Leaflet JS -->
    <script
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""
    ></script>
</head>
<body>
    <div class="container">
        <h1 class="page-title">澳门罕有街道影像集</h1>

        <!-- 1. 澳门地图区域（使用Leaflet加载在线地图） -->
        <div class="map-container">
            <h3 class="map-title">澳门内港影像拍摄区域参考</h3>
            <div id="macau-map" class="map-box"></div>
            <p class="map-tip">点击地图标记可查看对应区域照片（待完善）</p>
        </div>

        <!-- 2. 照片浏览区域（保留下载限额） -->
        <div class="photo-container">
            <div class="photo-box">
                <div id="photo-loading" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="loading-spinner"></div>
                    <div style="font-size: 20px; color: #666;">加载中... 正在读取照片</div>
                </div>
                <img id="current-photo" src="" alt="澳门内港街景照片" style="display: none;">
                <div id="photo-error" class="error-message" style="display: none; padding: 20px;"></div>
            </div>
            <div class="photo-info" id="photo-info">照片名称：-- / 总数：--</div>
            <div class="btn-group">
                <button id="prev-btn" class="nav-btn" disabled>上一张</button>
                <button id="next-btn" class="nav-btn" disabled>下一张</button>
                <button id="download-btn" class="nav-btn" disabled>下载当前照片</button>
                <span id="download-count" style="margin-left: 15px; font-size: 14px; color: #666;">今日剩余下载次数：10</span>
            </div>
        </div>

        <!-- 3. 自由反馈表单（支持自定义内容+图片上传） -->
        <div class="form-container">
            <h3 class="form-title">自由反馈与观点表达</h3>
            <p class="form-desc">可自由发送意见、照片补充建议，支持上传参考图片</p>
            
            <form id="feedback-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="feedback-email">你的邮箱（方便回复）：</label>
                    <input type="email" id="feedback-email" placeholder="请输入你的邮箱" required value="25eqsg3f08@g.elctp.k12.edu.mo">
                </div>
                <div class="form-group">
                    <label for="feedback-title">反馈标题（自定义）：</label>
                    <input type="text" id="feedback-title" placeholder="例如：关于XX街道照片的补充建议" required>
                </div>
                <div class="form-group">
                    <label for="feedback-content">反馈内容（自由表达）：</label>
                    <textarea id="feedback-content" rows="6" placeholder="可描述观点、补充街道历史、建议优化方向等..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="feedback-img">上传参考图片（可选）：</label>
                    <input type="file" id="feedback-img" accept="image/jpg,image/png,image/jpeg">
                    <p class="file-tip">支持JPG/PNG格式，单个文件不超过5MB</p>
                </div>
                <div class="form-group">
                    <button type="button" id="send-feedback" class="send-email-btn">发送反馈邮件</button>
                </div>
            </form>

            <!-- 反馈指南入口（原ALLCMD.html链接） -->
            <div class="guide-link">
                <a href="./ALLCMD.html" target="_blank">查看反馈填写指南 →</a>
            </div>
        </div>
    </div>

    <!-- 引入JS文件（顺序：地图→下载→主逻辑→反馈） -->
    <script src="./js/macau_map.js"></script>
    <script src="./js/download.js"></script>
    <script src="./js/main.js"></script>
    <script>
        // 自由反馈邮件逻辑（内嵌，避免新增文件）
        document.getElementById('send-feedback').addEventListener('click', function() {
            const email = document.getElementById('feedback-email').value;
            const title = document.getElementById('feedback-title').value;
            const content = document.getElementById('feedback-content').value;
            const file = document.getElementById('feedback-img').files[0];
            
            // 基础校验
            if (!email || !title || !content) {
                alert('邮箱、标题、内容为必填项，请完善后提交！');
                return;
            }

            // 若有文件，提示需手动附件（mailto协议不支持自动上传，需引导）
            let mailBody = `反馈人邮箱：${email}%0A%0A反馈内容：${content.replace(/\n/g, '%0A')}`;
            if (file) {
                mailBody += `%0A%0A提示：已选择上传图片《${file.name}》，请在邮件客户端中手动添加该文件为附件后发送。`;
            }

            // 唤起邮件客户端（收件人固定为项目邮箱）
            const recipient = '25eqsg3f08@g.elctp.k12.edu.mo';
            window.location.href = `mailto:${recipient}?subject=${encodeURIComponent(title)}&body=${encodeURIComponent(mailBody)}`;
            
            // 重置表单
            document.getElementById('feedback-form').reset();
            alert('已唤起邮件客户端，请检查内容后发送！若有上传图片，需手动添加附件。');
        });
    </script>
</body>
</html>
